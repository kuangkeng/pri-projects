<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
<head>
<title>What if your hometown were hit by the Hiroshima atomic bomb?</title>
<meta name="description" content="What if your hometown were hit by the Hiroshima atomic bomb?"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:type" content="website" /> 
<meta property="og:site_name" content="Hiroshima Generations: The memory passed on" />
<meta property="og:description" content="What would be the damage if the Hiroshima atomic bomb were dropped on your hometown?"/>
<meta property="og:title" content="What if your hometown were hit by the Hiroshima atomic bomb?" />
<meta property="og:url" content="http://www.pri.org/stories/2015-08-03/what-if-your-hometown-were-hit-hiroshima-atomic-bomb"/>
<meta property="og:image" content="http://admin.pri.org/sites/default/files/nukeshot.png"/>
<meta property="fb:app_id" content="934801873242745"/>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.20&libraries=geometry,visualization&sensor=false"></script>

<style type="text/css">


*, *:before, *:after {
  -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;
 }

html {  -webkit-text-size-adjust: none; height: 100%; width: 100%; overflow: hidden; }
body {
  font-family: "Source Sans Pro","Helvetica Neue",Helvetica,Arial,"Nimbus Sans L",sans-serif;
}
h1 { text-align: center; font-size: 22px; font-size: 4vh; line-height: 22px; line-height: 4vh; font-weight: bold; color: #D3401E; }
#map-canvas { position: absolute; top: 0; left: 0; height: 100%; width: 100% }
#white-canvas { position: absolute; top: 0; left: 0; height: 100%; width: 100%; z-index: 1; background-color: white; display:none;}

.panel { position: absolute; bottom: 0px; left: 0; width: 100%; text-align: center; display: none; padding: 0px 10px; font-size: 14px; font-size: 2.5vh; line-height: 20px; line-height: 3vh; color: #000000; background-color: rgba(255,255,255,0.7); z-index: 1;}
.panel button { 
  width: 30%; 
  padding: 10px 10px; 
  font-size: 14px; 
  font-size: 3vh; 
  line-height: 14px; 
  line-height: 2.5vh; 
  color: #D3401E;
  font-weight: bold;
  margin-bottom: 0.2em;
}

button:disabled {
  color: #696969;
  font-weight: normal;
}

#credit {
  position: absolute; bottom:5px; right:5px; font-size:1.5vh; color:#666666;
}

a {
    color: #666666;
}

#referral {
  padding:5px 0px;
}

#searchbox { width: 12em; padding: 5px 5px; font-size: 14px; font-size: 2vh; background: transparent; border: 1px solid #eee; color: #000000; }

#findbutton { border: 1px solid #C3C3C3; width: 5em; padding: 5px 5px; font-size: 14px; font-size: 2vh; background: #EBEBEB; color: #000000; text-align: center;}

#findbutton:hover {background: #F5F5F5;}

#redbutton, #redbuttondark {
    width:15%;
    margin:0 auto;
}

table {
    width:100%;
    max-width: 800px;
    margin: 0 auto;
    padding:0px 10px;
}

#indicator {height: 50%;}

@media screen and (min-aspect-ratio: 1/1) {

  #results button { width: 30%; }
}

@media (max-width: 500px ) { 
  h1 {font-size: 3vh; line-height: 20px;}
  .panel{font-size: 2vh; line-height: 15px; padding: 5px 10px 5px 10px;}
  .panel button {font-size: 2.5vh; width:50%;}
  #indicator {width:50%; height:auto;}
  #credit {font-size: 1.3vh;}
  #referral{margin-bottom: 10px;}
}

.wait { cursor: wait; }

</style>
<script>

var sv;
var map;
var state = 0;

var homeCircle = "http://admin.pri.org/sites/default/files/tidal-icon-blue-small.png";

var homeMarker = new google.maps.Marker({icon: homeCircle});
var startPosition = new google.maps.LatLng(20,0);
var startZoom = 2;
var country_code;

var mapOptions = {
  zoom: startZoom,
  minZoom: 1,
  maxZoom: 21,
  center: startPosition,
  disableDefaultUI: true,
  zoomControl: true,
  mapTypeId: google.maps.MapTypeId.HYBRID
};

var geocoder = new google.maps.Geocoder();

function panel(id) {

  $('.panel').slideUp(500);
  $('#' + id).slideDown(500);
 
}

//to get the country code of users
function codeLatLng(latlng) {
  country_code = 'xx';
  geocoder.geocode({'latLng': latlng}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
      if (results[0]) {
        try {
          var x;
          for (var i=0;i<results[0].address_components.length;i++) {
            x = results[0].address_components[i].types;
            if (x.indexOf('country') != -1) {
              country_code = results[0].address_components[i].short_name;
            }
          }
        } catch(err) {
          country_code = 'xx';
        }
      }
    } else {
      country_code = 'xx';
    }
  });
}


function handleClick(latLng) {

  switch(state) {
  
    case 1:
      homeMarker.setPosition(latLng);
      homeMarker.setMap(map);
      codeLatLng(latLng);
      $('#home_placed').attr('disabled',false);
      break;
  }
}

function init() {
  $("#redbuttondark").hide();
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  map.setTilt(45);
  var worldBounds = new google.maps.LatLngBounds(new google.maps.LatLng(-65,-20),
                                                 new google.maps.LatLng(65,20));
  map.fitBounds(worldBounds);


  panel('instructions');
  
  $('#start').click(function () {
    panel('you');
    state = 1;
  
  });
  
  $('#home_placed').click(function () {
  
    panel('dropbomb');
    
  });
  
  $('#redbutton').one("click", function () {

    $("#redbutton").hide();
    $("#redbuttondark").show();

    $("#white-canvas").fadeIn(2000, function(){
      $("#white-canvas").fadeOut(2000);
      //console.log("homeMarker = " + homeMarker.position);
      
      //constuct a transparent circle to get bounds
      var radiusOptions = {
        strokeColor: "#FFFF00",
        strokeOpacity: 1,
        strokeWeight: 0,
        fillColor: "#FFFF00",
        fillOpacity: 0,
        map: map,
        center: homeMarker.position,
        radius: 19312.1, //equals to 12 miles
        };
      var circle = new google.maps.Circle(radiusOptions);
      var circlebounds = circle.getBounds();
      //console.log("circlebounds = " + circlebounds);

      //place the nukecirlce image based on circlebounds
      var nukeOpacity = {opacity:0.7};
      var nukeOverlay = new google.maps.GroundOverlay(
      'http://kuangkeng.github.io/pri-projects/images/nukecircle.png',
      circlebounds, nukeOpacity);
      nukeOverlay.setMap(map); 

      map.setCenter(homeMarker.position);
      map.setZoom(11);
      state = 3;
      
      panel('results');
    });

    $.ajax({
      type: 'POST',
      url: 'https://docs.google.com/forms/d/1LuEBK4cZcc6HuMgjtcp3iMvDBzMFxesfAwsYdooegok/formResponse',
      data: 
      { 
        "entry.1528855925": homeMarker.position.lat(),
        "entry.804927876": homeMarker.position.lng(),
        "entry.542656369": country_code,
        "entry.547749403": document.referrer,
       }
    });
  });
    
  google.maps.event.addListener(map, 'click', function(event) {
    handleClick(event.latLng);
  });

  $('#tweet').click(function (event) {
  
    tweet();
  
  });  
  $('#facebook').click(function (event) {
  
    facebook();
  
  });

}
google.maps.event.addDomListener(window, 'load', init);

function jumptocitytext() {
    var address = document.getElementById("searchbox").value;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
    map.setZoom(13);
    homeMarker.setPosition(results[0].geometry.location);
    map.setCenter(homeMarker.getPosition());
      };
    });
}

function tweet() {
  var tweet_url = 'https://twitter.com/intent/tweet?related=pritheworld&text=';
  tweet_url += encodeURIComponent("What would a Hiroshima-sized atomic bomb do to my hometown? I found out, and you can too.");
  tweet_url += '&url=http://bit.ly/1KMseYs&via=pri&hashtags=Hiroshima70';
  window.open(tweet_url,'_blank'); 
}

function facebook() {
FB.ui({
  method: 'feed',
  link: 'http://www.pri.org/stories/2015-08-03/what-if-your-hometown-were-hit-hiroshima-atomic-bomb',
  picture: 'http://admin.pri.org/sites/default/files/nukeshot.png',
  name: "What if your hometown were hit by the Hiroshima atomic bomb?",
  description: 'Have you ever thought about the damage caused by the atomic bomb dropped on Hiroshima on August 6, 1945? This app allows you to simulate the damage of the atomic bomb attack on Hiroshima 70 years ago on another location, such as your hometown. #Hiroshima70'
  }, function(response){});
}

</script>


</head>

<body>

<div id="map-canvas">
</div>
<div id="white-canvas">
</div>

<div id="instructions" class="panel">
  <h1>What if your hometown were hit by the Hiroshima atomic bomb?</h1>
  <p>Have you ever thought about the damage caused by the atomic bomb dropped on Hiroshima on August 6, 1945? What would be the damage if that same atomic bomb were dropped on your hometown?</p>
  <p><button id="start">Start</button></p>
</div>

<div id="you" class="panel">
  <h1>Where are you from?</h1>
  <p>Type to find your hometown and click on the map to mark the target.</p>
  <p><input type="text" id="searchbox"> <input id="findbutton" type="submit" value="Find" onclick="jumptocitytext(); return false;"></p>
  <p><button id="home_placed" disabled>Target marked</button></p>
</div>

<div id="dropbomb" class="panel">
  <h1>Ready? Now drop the bomb</h1>
  <div>
    <img id="redbutton" src="http://admin.pri.org/sites/default/files/red-button.png">
    <img id="redbuttondark" src="http://admin.pri.org/sites/default/files/red-button-dark.png">
  </div>
</div>

<div id="results" class="panel">
  <h1>The bomb would cause damage within a 12-mile radius of ground zero</h1>
  <div id="details">
    <table>
      <tr>
        <td style="width:10%"><img id="indicator" src="http://admin.pri.org/sites/default/files/indicator4.png"></td>
        <td style="width:90%; text-align:left">Within 0.5 miles: 90% of people are killed by heavy fire and blast. Pregnant women who survive will experience miscarriage due to radiation.</td> 
      </tr>
      <tr>
        <td style="width:10%"><img id="indicator" src="http://admin.pri.org/sites/default/files/indicator3.png"></td>
        <td style="width:90%; text-align:left">Within 1 mile: 70% of people are killed by heavy fire and blast. Everything up to this distance is completely destroyed by heavy fire from the explosion at ground zero.</td> 
      </tr>
      <tr>
        <td style="width:10%"><img id="indicator" src="http://admin.pri.org/sites/default/files/indicator2.png"></td>
        <td style="width:90%; text-align:left">Within 3 miles: Buildings up to this distance are heavily destroyed by fire that spreads from ground zero.</td> 
      </tr>
      <tr>
        <td style="width:10%"><img id="indicator" src="http://admin.pri.org/sites/default/files/indicator1.png"></td>
        <td style="width:90%; text-align:left">Within 12 miles: Buildings are safe but windows might be broken.</td> 
      </tr>
    </table>
  </div>
  <button id="tweet">Share on Twitter</button>
  <button id="facebook">Share on Facebook</button>
  <div id="referral">More <a href="http://bit.ly/1gPKAeT" target="_blank">#Hiroshima70 stories</a> at PRI.org</div>
</div>

<div id="credit">
  Created by <a href="https://twitter.com/kuangkeng" target="_blank">@kuangkeng</a><br>at <a href="http://www.pri.org/stories/2015-08-04/what-if-your-hometown-were-hit-hiroshima-atomic-bomb" target="_blank">PRI.org</a>
</div>

<div id="fb-root"></div>

<script>
    window.fbAsyncInit = function() {
    FB.init({
      appId      : '934801873242745',
      xfbml      : true,
      version    : 'v2.4'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
</body>

</html>
