
<!DOCTYPE html>
<html>
<head>
<title>Where's Addis Ababa?</title>
<meta name="description" content="What if Hiroshima atomic bomb was dropped on my hometown?"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:type" content="website" /> 
<meta property="og:site_name" content="Hiroshima Generations: The memory passed on" />
<meta property="og:description" content="What would the damage be if the atomic bomb that hit Hiroshima in 1945 was dropped on your hometown?"/>
<meta property="og:title" content="What if Hiroshima atomic bomb was dropped on my hometown?" />
<meta property="og:url" content="http://www.pri.org/stories/2015-07-23/obama-visiting-addis-ababa-do-you-know-where-it"/>
<meta property="og:image" content="http://admin.pri.org/sites/default/files/nukeshot.png"/>
<meta property="fb:app_id" content="658272894309512"/>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.4.2/tabletop.min.js"></script> 
<script src="https://maps.googleapis.com/maps/api/js?v=3.12&libraries=geometry,visualization&sensor=false"></script>


<!-- This map quiz code is modified from "Where's Damascus? (Don't Ask Us)" at games.usvsth3m.com/damascus 
Thanks for the neat and well structured code! -->

<style type="text/css">


*, *:before, *:after {
  -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;
 }

html {  -webkit-text-size-adjust: none; height: 100%; width: 100%; overflow: hidden; }
body {
  font-family: "Source Sans Pro","Helvetica Neue",Helvetica,Arial,"Nimbus Sans L",sans-serif;
}
h1 { text-align: center; font-size: 22px; font-size: 4vh; line-height: 22px; line-height: 4vh; font-weight: bold; color: #D3401E; }
#map-canvas { position: absolute; top: 0; left: 0; height: 100%; width: 100%; z-index: -1; }
#white-canvas { position: absolute; top: 0; left: 0; height: 100%; width: 100%; z-index: 0; background-color: white; display:none;}

.panel { position: absolute; bottom: 0px; left: 0; width: 100%; text-align: center; display: none; padding: 10px 0px ; font-size: 14px; font-size: 2vh; line-height: 18px; line-height: 2vh; color: #000000; background-color: rgba(255,255,255,0.6);}
.panel button { 
  width: 50%; 
  padding: 10px 10px; 
  font-size: 14px; 
  font-size: 2vh; 
  line-height: 14px; 
  line-height: 2vh; 
  margin-top: 0.5em; 
}
.panel input { width: 3em; padding: 5px 0px; font-size: 14px; font-size: 2vh; margin-top: 0.5em; text-align: right; border: none; background: transparent; outline: none; border-bottom: 1px dotted #eee; color: #000000; }
.panel input:invalid { outline: none; }
#guess { width: 4em; }
.panel p { padding-bottom: 0.2em; }

p.data { font-size: 12px !important; margin-top: 10px; }

#redbutton, #redbuttondark {
    width:5%;
    margin:0 auto;
}

table {
    width:100%;
    max-width: 800px;
    margin: 0 auto;
    padding:0px 10px;
}

#indicator {height: 80%;}

@media screen and (min-aspect-ratio: 1/1) {

  #results button { width: 30%; }

}

@media (max-width: 500px ) { 
  h1 {font-size: 24px; line-height: 25px;}
  .panel{font-size: 16px; line-height: 22px; padding: 5px 10px 5px 10px;}
  .panel button {font-size: 17px; width:80%;}

}

.wait { cursor: wait; }

</style>
<script>

var sv;
var map;
var state = 0;

var homeCircle = {
  path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
  scale: 3,
  strokeColor: "#ff7f00",
  strokeWeight: 3
};

var homeMarker = new google.maps.Marker({icon: homeCircle});

var tweet_rating = [
"Thank goodness I’m not flying Air Force One. ",
"Thank goodness I’m not flying Air Force One. ",
"Can someone please tell me where Addis Ababa is?",
"Can someone please tell me where Addis Ababa is?",
"I’m not *too* far off from Addis Ababa.",
"I’m not *too* far off from Addis Ababa.",
"Addis Ababa? I totally know where it is.",
"Addis Ababa? I totally know where it is.",
"Obama is going to Addis Ababa, and I’m the expert.",
"Obama is going to Addis Ababa, and I’m the expert."
];

var rating = [
"Thank goodness you’re not flying Air Force One!",
"Thank goodness you’re not flying Air Force One!",
"You’re pretty far off…",
"You’re pretty far off…",
"You’re definitely on your way to Addis Ababa.",
"You’re definitely on your way to Addis Ababa.",
"Hey, not bad! You’re pretty close to Addis Ababa!",
"Hey, not bad! You’re pretty close to Addis Ababa!",
"Is that you, Obama? You’re an Addis expert!",
"Is that you, Obama? You’re an Addis expert!"
];

var startPosition = new google.maps.LatLng(20,0);
var startZoom = 2;
var country_code;

var mapOptions = {
  zoom: startZoom,
  minZoom: 1,
  maxZoom: 21,
  center: startPosition,
  disableDefaultUI: true,
  zoomControl: true,
  mapTypeId: google.maps.MapTypeId.HYBRID
};

var geocoder = new google.maps.Geocoder();

function panel(id) {

  $('.panel').slideUp(500);
  $('#' + id).slideDown(500);
 
}

//to get the country code of users
function codeLatLng(latlng) {
  country_code = 'xx';
  geocoder.geocode({'latLng': latlng}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
      if (results[0]) {
        try {
          var x;
          for (var i=0;i<results[0].address_components.length;i++) {
            x = results[0].address_components[i].types;
            if (x.indexOf('country') != -1) {
              country_code = results[0].address_components[i].short_name;
            }
          }
        } catch(err) {
          country_code = 'xx';
        }
      }
    } else {
      country_code = 'xx';
    }
  });
}


function handleClick(latLng) {

  switch(state) {
  
    case 1:
      homeMarker.setPosition(latLng);
      homeMarker.setMap(map);
      codeLatLng(latLng);
      $('#home_placed').attr('disabled',false);
      break;
  }
}

function init() {
  $("#redbuttondark").hide();
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  map.setTilt(45);
  var worldBounds = new google.maps.LatLngBounds(new google.maps.LatLng(-65,-20),
                                                 new google.maps.LatLng(65,20));
  map.fitBounds(worldBounds);


  panel('instructions');
  
  $('#start').click(function () {
    panel('you');
    state = 1;
  
  });
  
  $('#home_placed').click(function () {
  
    panel('dropbomb');
    
  });
  
  $('#redbutton').one("click", function () {

    $("#redbutton").hide();
    $("#redbuttondark").show();

    $("#white-canvas").fadeIn(2000, function(){
      $("#white-canvas").fadeOut(2000);
      console.log("homeMarker = " + homeMarker.position);
      
      //constuct a transparent circle to get bounds
      var radiusOptions = {
        strokeColor: "#FFFF00",
        strokeOpacity: 1,
        strokeWeight: 0,
        fillColor: "#FFFF00",
        fillOpacity: 0,
        map: map,
        center: homeMarker.position,
        radius: 19312.1, //equals to 12 miles
        };
      var circle = new google.maps.Circle(radiusOptions);
      var circlebounds = circle.getBounds();
      console.log("circlebounds = " + circlebounds);

      //place the nukecirlce image based on circlebounds
      var nukeOpacity = {opacity:0.7};
      var nukeOverlay = new google.maps.GroundOverlay(
      'http://kuangkeng.github.io/pri-projects/images/nukecircle.png',
      circlebounds, nukeOpacity);
      nukeOverlay.setMap(map); 
      console.log("nukeOverlay = " + nukeOverlay);
  
      map.setCenter(homeMarker.position);
      map.setZoom(11);
      state = 3;
      
      panel('results');
    });
  });
    
  google.maps.event.addListener(map, 'click', function(event) {
    handleClick(event.latLng);
  });

  $('#tweet').click(function (event) {
  
    tweet();
  
  });  
  $('#facebook').click(function (event) {
  
    facebook();
  
  });

}
google.maps.event.addDomListener(window, 'load', init);

function jumptocitytext() {
    var address = document.getElementById("jumptocity").value;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
    map.setZoom(13);
    homeMarker.setPosition(results[0].geometry.location);
    map.setCenter(homeMarker.getPosition());
      };
    });
}

function tweet() {
  var tweet_url = 'https://twitter.com/intent/tweet?related=pritheworld&text=';
  tweet_url += encodeURIComponent(tweet_rating[Math.floor(score/10)]);
  tweet_url += encodeURIComponent(" I'm " + Math.round(miles) + " miles away. Can you beat me?");
  tweet_url += '&url=http://bit.ly/1GHiF5m&via=pri&hashtags=whereisaddisababa';
  window.open(tweet_url,'_blank'); 
}

function facebook() {
FB.ui({
  method: 'feed',
  link: 'http://www.pri.org/stories/2015-07-23/obama-visiting-addis-ababa-do-you-know-where-it',
  picture: 'http://admin.pri.org/sites/default/files/map-quiz.png',
  name: "Where's Addis Ababa",
  description: tweet_rating[Math.floor(score/10)] + ' I missed the exact location by ' + Math.round(miles) + ' miles, better than ' + score + '% of people. Can you beat me? Take this map quiz and tell the world how good you are at locating Addis Ababa.'
  }, function(response){});
}

</script>


</head>

<body>

<div id="map-canvas">
</div>
<div id="white-canvas">
</div>

<div id="instructions" class="panel">
  <h1>If your hometown was hit by Hiroshima atomic bomb</h1>
  <p>Have you ever thought about the damage caused by the atomic bomb dropped on Hiroshima on August 6, 1945? What if the same atomic bomb was dropped on your hometown?</p>
  <p><button id="start">Let's try it</button></p>
</div>

<div id="you" class="panel">
  <h1>Where are you from?</h1>
  <p>Type to find your hometown and click on the map to mark where you want to drop the bomb.</p>
  <p><input type="text" id="jumptocity"> <input type="submit" value="Find" onclick="jumptocitytext(); return false;"></p>
  <p><button id="home_placed" disabled>Target marked</button></p>
</div>

<div id="dropbomb" class="panel">
  <h1>Ready? Now drop the bomb</h1>
  <div>
    <img id="redbutton" src="http://admin.pri.org/sites/default/files/red-button.png">
    <img id="redbuttondark" src="http://admin.pri.org/sites/default/files/red-button-dark.png">
  </div>
</div>

<div id="results" class="panel">
  <h1>The bomb would cause damage within 12 mile radius of ground zero</h1>
  <div id="details">
    <table>
      <tr>
        <td style="width:25%"><img id="indicator" src="http://admin.pri.org/sites/default/files/indicator4.png"></td>
        <td style="width:75%; text-align:left">Within 0.5 mile: 90% of people are killed by fire blast. Pregnant women who survive will experience miscarriage due to radiation.</td> 
      </tr>
      <tr>
        <td style="width:25%"><img id="indicator" src="http://admin.pri.org/sites/default/files/indicator3.png"></td>
        <td style="width:75%; text-align:left">Within 1.0 mile: 80% of people are killed by fire blast. Everything up to this distance is completely destroyed by heavy fire from the explosion at ground zero.</td> 
      </tr>
      <tr>
        <td style="width:25%"><img id="indicator" src="http://admin.pri.org/sites/default/files/indicator2.png"></td>
        <td style="width:75%; text-align:left">Within 3.0 mile: Buildings up to this distance are heavily destroyed by fire that spread from ground zero.</td> 
      </tr>
      <tr>
        <td style="width:25%"><img id="indicator" src="http://admin.pri.org/sites/default/files/indicator1.png"></td>
        <td style="width:75%; text-align:left">Buildings are safe but their glasses might be broken.</td> 
      </tr>
    </table>
  </div>
  <button id="tweet">Tweet your score</button>
  <button id="facebook">Share on Facebook</button>
</div>

<div id="fb-root"></div>

<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '658272894309512',
      xfbml      : true,
      version    : 'v2.4'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
</body>

</html>
